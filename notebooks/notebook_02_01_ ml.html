<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Matt Lawrence">
<meta name="dcterms.date" content="2023-09-19">

<title>Week Two, Class One</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="notebook_02_01_ ml_files/libs/clipboard/clipboard.min.js"></script>
<script src="notebook_02_01_ ml_files/libs/quarto-html/quarto.js"></script>
<script src="notebook_02_01_ ml_files/libs/quarto-html/popper.min.js"></script>
<script src="notebook_02_01_ ml_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="notebook_02_01_ ml_files/libs/quarto-html/anchor.min.js"></script>
<link href="notebook_02_01_ ml_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="notebook_02_01_ ml_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="notebook_02_01_ ml_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="notebook_02_01_ ml_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="notebook_02_01_ ml_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="notebook_02_01_ ml_files/libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="notebook_02_01_ ml_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="notebook_02_01_ ml_files/libs/datatables-binding-0.29/datatables.js"></script>
<script src="notebook_02_01_ ml_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="notebook_02_01_ ml_files/libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="notebook_02_01_ ml_files/libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="notebook_02_01_ ml_files/libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script>
<link href="notebook_02_01_ ml_files/libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="notebook_02_01_ ml_files/libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week Two, Class One</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Matt Lawrence </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 19, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting Started</h2>
<p>To begin, copy all the text on this screen. Then open RStudio, and in the “File” menu select “New File” then “Quarto Document”. Add a title like “SOCI 385, Week Two, Class One”, include your name in the “Author” box, select “HTML” as the output format, and click Create. A default markdown file will open. Delete all the text in the default file below the header (everything after line 5) and paste in the text you copied to your clipboard. Make sure that “Quarto” is selected in the file type drop down menu in the bottom right corner of this pane. Also make sure that you are using the <code>Source</code> editing view (you should have line numbers in this document). Save this file.</p>
<p>Load the packages we will be using:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># for data wrangling</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.3     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.3     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT) <span class="co"># for datatable</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Load the dataset as a data frame called <code>colleges</code> using the <code>read_csv()</code> function. This comes from the <code>tidyverse</code> package and is slightly different from <code>read.csv()</code> which we saw last week.</p>
<p>All the extra info that R reported when we loaded the packages was annoying. We can suppress those messages by adding the <code>message: FALSE</code> option in a chunk option:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>colleges <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/mjclawrence/soci385_f23/main/data/colleges.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How many observations and variables are there in this data frame?</p>
<p>What kind of variable is the <code>tier</code> variable? (<code>tier</code> is the college selectivity)</p>
<p>What kind of variable is <code>par_top1pc</code> variable? (<code>par_top1pc</code> is the proportion of students from a college with parent income in the top 1%)</p>
</section>
<section id="reviewing-tables" class="level2">
<h2 class="anchored" data-anchor-id="reviewing-tables">Reviewing Tables</h2>
<p>Let’s do a quick review of the functions we started looking at last week. If you want to know how many colleges in this data frame are in each tier, you could make a table of the <code>tier</code> variable. Try it!</p>
<section id="replace-this-line-with-your-code-chunk" class="level3">
<h3 class="anchored" data-anchor-id="replace-this-line-with-your-code-chunk">REPLACE THIS LINE WITH YOUR CODE CHUNK</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(colleges<span class="sc">$</span>tier)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                Highly selective private 
                                      16 
                 Highly selective public 
                                      19 
                                Ivy Plus 
                                      12 
Other elite schools (public and private) 
                                      60 
                       Selective private 
                                       4 
                        Selective public 
                                      28 </code></pre>
</div>
</div>
<p>The table lists categories in alphabetical order by default. With only six possible values, it is pretty easy to pick out the <em>modal value</em> even when they are alphabetical. If there are many categories - like all the possible names of hurricanes - it would be easier to sort the categories by the number of observations. You can do so by wrapping the full <code>table()</code> code within the <code>sort()</code> function:</p>
</section>
<section id="replace-this-line-with-your-code-chunk-1" class="level3">
<h3 class="anchored" data-anchor-id="replace-this-line-with-your-code-chunk-1">REPLACE THIS LINE WITH YOUR CODE CHUNK</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">table</span>(colleges<span class="sc">$</span>tier), <span class="at">decreasing=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Other elite schools (public and private) 
                                      60 
                        Selective public 
                                      28 
                 Highly selective public 
                                      19 
                Highly selective private 
                                      16 
                                Ivy Plus 
                                      12 
                       Selective private 
                                       4 </code></pre>
</div>
</div>
<p>Once you have multiple sets of parentheses, it can be helpful to turn on the rainbow parentheses option. In the Code menu, select “Rainbow parentheses” if it is not checked.</p>
<p>Last week’s notebook included a quick look at how to index. Indexing allows you to run a function or display values for one variable by specific values of that same variable or a different variable. We index with [brackets].</p>
<p>Suppose we want to find the <code>tier</code> that Middlebury College is in. More formally, we want to pull the value of the <code>tier</code> variable for the observation whose value for the <code>name</code> variable is <code>Middlebury College</code>. Since we are only referencing one value of the <code>name</code> variable, we identify it with two equal signs. Note that we also have to put “Middlebury College” in quotation marks since it is a character value rather than a numerical value:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>colleges<span class="sc">$</span>tier[colleges<span class="sc">$</span>name<span class="sc">==</span><span class="st">"Middlebury College"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Other elite schools (public and private)"</code></pre>
</div>
</div>
<p>Other indexing tools that are helpful:</p>
<ul>
<li>For not equal to, use !=</li>
<li>To connect multiple arguments with and, use &amp;</li>
<li>To connect multiple arguments with or, use |</li>
</ul>
<p>Try pulling the tiers for Middlebury College and the Massachusetts Institute of Technology in the same chunk.</p>
</section>
<section id="replace-this-line-with-your-code-chunk-2" class="level3">
<h3 class="anchored" data-anchor-id="replace-this-line-with-your-code-chunk-2">REPLACE THIS LINE WITH YOUR CODE CHUNK</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>colleges<span class="sc">$</span>tier[colleges<span class="sc">$</span>name<span class="sc">==</span><span class="st">"Massachusetts Institute Of Technology"</span> <span class="sc">|</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                colleges<span class="sc">$</span>name<span class="sc">==</span><span class="st">"Middlebury College"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Ivy Plus"                                
[2] "Other elite schools (public and private)"</code></pre>
</div>
</div>
<p>And for numeric variables:</p>
<ul>
<li>For greater than, use &gt;</li>
<li>For less than, use &lt;</li>
<li>For greater than or equal to, use &gt;=</li>
<li>For less than or equal to, use &lt;=</li>
</ul>
<p>How would you find the number of public and private colleges in the “Other elite schools (public and private)” tier?</p>
</section>
<section id="replace-this-line-with-your-code-chunk-3" class="level3">
<h3 class="anchored" data-anchor-id="replace-this-line-with-your-code-chunk-3">REPLACE THIS LINE WITH YOUR CODE CHUNK</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(colleges<span class="sc">$</span>public[colleges<span class="sc">$</span>tier<span class="sc">==</span><span class="st">"Other elite schools (public and private)"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Private  Public 
     56       4 </code></pre>
</div>
</div>
<p>The table reports frequencies, or counts of observations. We can find the <em>proportion</em> in this tier by wrapping the whole line in the <code>prop.table()</code> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(colleges<span class="sc">$</span>public[colleges<span class="sc">$</span>tier<span class="sc">==</span><span class="st">"Other elite schools (public and private)"</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   Private     Public 
0.93333333 0.06666667 </code></pre>
</div>
</div>
<p>Want to round? Wrap the table in the <code>round()</code> function and add an option for the number of post-decimal digits to include. In this example, we round to 2 decimal places.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(colleges<span class="sc">$</span>public[colleges<span class="sc">$</span>tier<span class="sc">==</span><span class="st">"Other elite schools (public and private)"</span>])),<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Private  Public 
   0.93    0.07 </code></pre>
</div>
</div>
</section>
</section>
<section id="reviewing-summaries" class="level2">
<h2 class="anchored" data-anchor-id="reviewing-summaries">Reviewing Summaries</h2>
<p>For numeric variables, using <code>summary()</code> to explore the distribution is better than a table. Let’s find the distribution of the <code>rel_attend_sat</code> variable. This variable measures the chances that a student from the top 1% of the income distribution will attend a college compared to other students with the same SAT scores.</p>
<section id="replace-this-line-with-your-code-chunk-4" class="level3">
<h3 class="anchored" data-anchor-id="replace-this-line-with-your-code-chunk-4">REPLACE THIS LINE WITH YOUR CODE CHUNK</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(colleges<span class="sc">$</span>rel_attend_sat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.1775  0.9686  1.7485  1.9961  2.6704  7.6751 </code></pre>
</div>
</div>
<p>What do these numbers tell us? What is the range? The interquartile range? The median? The mean?</p>
<p>Where does Middlebury fall in the distribution? Start by recalling Middlebury’s value for the <code>rel_attend_sat</code> variable using indexing.</p>
</section>
<section id="replace-this-line-with-your.-codechunk" class="level3">
<h3 class="anchored" data-anchor-id="replace-this-line-with-your.-codechunk">REPLACE THIS LINE WITH YOUR. CODECHUNK</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>colleges<span class="sc">$</span>rel_attend_sat[colleges<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"Middlebury College"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.904448</code></pre>
</div>
</div>
<p>How would you interpret this number?</p>
<p>The <code>summary()</code> function’s defaults do not show exactly where Middlebury is. We can use the <code>quantile()</code> function to get percentile cutoffs for different parts of the distribution. Include the variable you want, then a comma, then <code>c()</code> with the cutoffs you want. We will see the <code>c()</code> function a lot. It is a helpful way to concatenate or connect terms.</p>
<p>In this example, we want to know the 80th and 90th percentiles of the distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(colleges<span class="sc">$</span>rel_attend_sat, <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     80%      90% 
2.934479 3.533371 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(colleges<span class="sc">$</span>rel_attend_sat, <span class="fu">c</span>(<span class="fl">0.79</span>, <span class="fl">0.8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     79%      80% 
2.864757 2.934479 </code></pre>
</div>
</div>
<p>You can use <code>quantile()</code> to get any percentile in the distribution. That would allow you to recreate all the points that <code>summary()</code> gives except the mean. If you only want the mean, use the <code>mean()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(colleges<span class="sc">$</span>rel_attend_sat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.996102</code></pre>
</div>
</div>
<p>A twist: How would you find the colleges with higher <code>rel_attend_sat</code> values than Middlebury College?</p>
</section>
<section id="replace-this-line-with-your-code-chunk-5" class="level3">
<h3 class="anchored" data-anchor-id="replace-this-line-with-your-code-chunk-5">REPLACE THIS LINE WITH YOUR CODE CHUNK</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(colleges<span class="sc">$</span>name[colleges<span class="sc">$</span>rel_attend_sat <span class="sc">&gt;</span> colleges<span class="sc">$</span>rel_attend_sat[colleges<span class="sc">$</span>name<span class="sc">==</span><span class="st">"Middlebury College"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                  Bates College               Baylor University 
                              1                               1 
                 Boston College             Bucknell University 
                              1                               1 
                  Colby College              Colgate University 
                              1                               1 
            Connecticut College                Davidson College 
                              1                               1 
                Elon University     Franklin &amp; Marshall College 
                              1                               1 
               Hamilton College                  Kenyon College 
                              1                               1 
              Lafayette College               Lehigh University 
                              1                               1 
    Loyola Marymount University           Pepperdine University 
                              1                               1 
         Santa Clara University   Southern Methodist University 
                              1                               1 
            Syracuse University      Texas Christian University 
                              1                               1 
Trinity College of Hartford, CT             University Of Miami 
                              1                               1 
      University Of Mississippi          University Of Richmond 
                              1                               1 
           Villanova University          Wake Forest University 
                              1                               1 
  Washington And Lee University              Yeshiva University 
                              1                               1 </code></pre>
</div>
</div>
</section>
</section>
<section id="taking-advantage-of-tidyverse" class="level2">
<h2 class="anchored" data-anchor-id="taking-advantage-of-tidyverse">Taking advantage of tidyverse</h2>
<p>For simple indexing, bracketing works. But we can start to see the limits here. Some tidyverse functions will make this easier.</p>
<p>The tidyverse function that is the equivalent of indexing is <code>filter()</code>. It chooses the rows you want.</p>
<p>In this example, we want to make a new dataframe called <code>Middlebury</code> that only keeps the rows of the original <code>colleges</code> data frame where the value of the name variable is equal to “Middlebury College”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>middlebury <span class="ot">&lt;-</span> <span class="fu">filter</span>(colleges, name <span class="sc">==</span> <span class="st">"Middlebury College"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>select()</code> function chooses which columns you want. In this example, we only want the columns <code>name</code> and <code>rel_attend</code> from the new <code>middlebury</code> data frame. The <code>rel_attend</code> variable is relative chances of attending for students from the top 1% without adjusting for the SAT.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(middlebury, name, rel_attend)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  name               rel_attend
  &lt;chr&gt;                   &lt;dbl&gt;
1 Middlebury College       10.6</code></pre>
</div>
</div>
<p>The real power comes when we combine functions. The advantage of this approach is that we can <em>chain</em> functions together using the pipe operator (|&gt;) that we set up last class. Now we only need to state the dataframe once.</p>
<p>The syntax here is that we are doing something with the <code>colleges</code> dataframe (we’ll go back to the full dataset), and then in each line list what you are doing with the dataframe. Connect each function with a pipe (|&gt;). So if we wanted to pull the value of the <code>rel_attend</code> variable for Middlebury we could do this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>colleges <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Middlebury College"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(rel_attend)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  rel_attend
       &lt;dbl&gt;
1       10.6</code></pre>
</div>
</div>
<p>Try using a chain to find the names of the colleges and the <code>rel_attend</code> values for the colleges with higher <code>rel_attend</code> values than Middlebury.</p>
<section id="replace-this-line-with-your-code-chunk-6" class="level3">
<h3 class="anchored" data-anchor-id="replace-this-line-with-your-code-chunk-6">REPLACE THIS LINE WITH YOUR CODE CHUNK</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>colleges <span class="sc">|&gt;</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rel_attend <span class="sc">&gt;</span> <span class="fl">10.63615</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, rel_attend)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 2
   name                               rel_attend
   &lt;chr&gt;                                   &lt;dbl&gt;
 1 Bucknell University                      11.5
 2 Colgate University                       12.2
 3 Dartmouth College                        12.4
 4 Duke University                          11.8
 5 Georgetown University                    10.8
 6 Middlebury College                       10.6
 7 Southern Methodist University            13.0
 8 Trinity College of Hartford, CT          12.3
 9 University Of Pennsylvania               10.7
10 Vanderbilt University                    11.1
11 Wake Forest University                   12.3
12 Washington And Lee University            12.3
13 Washington University In St. Louis       12.2</code></pre>
</div>
</div>
<p>We used the <code>sort()</code> function with tables. The equivalent tidyverse function is <code>arrange()</code>. By default, <code>arrange()</code> arranges by the first column. Assert the variable you want to sort by using the <code>order_by</code> option.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>colleges <span class="sc">|&gt;</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rel_attend <span class="sc">&gt;</span> <span class="fl">10.63615</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, rel_attend) <span class="sc">|&gt;</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="at">order_by =</span> rel_attend)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 2
   name                               rel_attend
   &lt;chr&gt;                                   &lt;dbl&gt;
 1 Middlebury College                       10.6
 2 University Of Pennsylvania               10.7
 3 Georgetown University                    10.8
 4 Vanderbilt University                    11.1
 5 Bucknell University                      11.5
 6 Duke University                          11.8
 7 Colgate University                       12.2
 8 Washington University In St. Louis       12.2
 9 Trinity College of Hartford, CT          12.3
10 Wake Forest University                   12.3
11 Washington And Lee University            12.3
12 Dartmouth College                        12.4
13 Southern Methodist University            13.0</code></pre>
</div>
</div>
<p>To switch the order from minimum-to-maximum to maximum-to-minimum, simply put a negative sign in front of the variable by which you are ordering:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>colleges <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rel_attend <span class="sc">&gt;</span> <span class="fl">10.63615</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, rel_attend) <span class="sc">|&gt;</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="at">order_by =</span> <span class="sc">-</span>rel_attend)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 2
   name                               rel_attend
   &lt;chr&gt;                                   &lt;dbl&gt;
 1 Southern Methodist University            13.0
 2 Dartmouth College                        12.4
 3 Washington And Lee University            12.3
 4 Wake Forest University                   12.3
 5 Trinity College of Hartford, CT          12.3
 6 Washington University In St. Louis       12.2
 7 Colgate University                       12.2
 8 Duke University                          11.8
 9 Bucknell University                      11.5
10 Vanderbilt University                    11.1
11 Georgetown University                    10.8
12 University Of Pennsylvania               10.7
13 Middlebury College                       10.6</code></pre>
</div>
</div>
<p>If you want to sort columns interactively, the datatable package we saw last class works well with chains:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>colleges <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rel_attend <span class="sc">&gt;</span> <span class="fl">10.63615</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, rel_attend) <span class="sc">|&gt;</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-dae693928dbd55325660" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-dae693928dbd55325660">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13"],["Bucknell University","Colgate University","Dartmouth College","Duke University","Georgetown University","Middlebury College","Southern Methodist University","Trinity College of Hartford, CT","University Of Pennsylvania","Vanderbilt University","Wake Forest University","Washington And Lee University","Washington University In St. Louis"],[11.462481,12.155192,12.395867,11.799696,10.800277,10.636151,13.035071,12.272768,10.666822,11.081232,12.272875,12.347318,12.224758]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>name<\/th>\n      <th>rel_attend<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Use <code>filter()</code>, <code>select()</code>, and <code>datatable()</code> to get the name, rel_attend, rel_attend_sat, and par_top1pc variables for the colleges in the NESCAC test band tier. Where does Middlebury fall in each of these rankings?</p>
</section>
<section id="replace-this-line-with-your-code-chunk-7" class="level3">
<h3 class="anchored" data-anchor-id="replace-this-line-with-your-code-chunk-7">REPLACE THIS LINE WITH YOUR CODE CHUNK</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>colleges <span class="sc">|&gt;</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(test_band_tier <span class="sc">==</span> <span class="st">"NESCAC"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, rel_attend, rel_attend_sat, par_top1pc) <span class="sc">|&gt;</span> </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-d415d66da2a594d31e33" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d415d66da2a594d31e33">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11"],["Amherst College","Bates College","Bowdoin College","Colby College","Connecticut College","Hamilton College","Middlebury College","Trinity College of Hartford, CT","Tufts University","Wesleyan University","Williams College"],[9.203102100000001,9.782729099999999,9.5671368,10.47447,7.0393877,9.4905405,10.636151,12.272768,9.242402999999999,8.864285499999999,10.404689],[2.051353,4.004591,2.6859634,3.6214027,3.9524255,3.1316657,2.9044478,6.7242355,2.3448439,2.6529307,2.264756],[0.21125141,0.18308043,0.20415856,0.20441216,0.18006459,0.19554551,0.2275054,0.26239237,0.18630734,0.1660227,0.18114738]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>name<\/th>\n      <th>rel_attend<\/th>\n      <th>rel_attend_sat<\/th>\n      <th>par_top1pc<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="introducing-strings" class="level2">
<h2 class="anchored" data-anchor-id="introducing-strings">Introducing Strings</h2>
<p>We have simplified a lot from the original form of indexing using brackets. Let’s look at another tool to simplify character strings. Suppose we just want to type “Middlebury” instead of “Middlebury College” in a filter. We could use the <code>str_detect()</code> function to identify any observations that <em>detect</em> a string in a variable.</p>
<p>In this example, we want to filter the colleges dataframe to only include observations that detect in the <code>name</code> variable the value “Middlebury”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>colleges <span class="sc">|&gt;</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(name, <span class="st">"Middlebury"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 14
  name      public tier  test_band_tier par_income_lab rel_attend_sat rel_attend
  &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;          &lt;chr&gt;                   &lt;dbl&gt;      &lt;dbl&gt;
1 Middlebu… Priva… Othe… NESCAC         Top 1                    2.90       10.6
# ℹ 7 more variables: par_top1pc &lt;dbl&gt;, par_q1 &lt;dbl&gt;, par_q2 &lt;dbl&gt;,
#   par_q3 &lt;dbl&gt;, par_q4 &lt;dbl&gt;, par_q5 &lt;dbl&gt;, par_median &lt;dbl&gt;</code></pre>
</div>
</div>
<p>How could you use <code>filter()</code>, <code>select()</code> and <code>str_detect()</code> to pull the name, public, rel_attend, rel_attend_sat, and par_top1pc values for the California Institute of Technology and the Massachusetts Institute of Technology?</p>
<section id="replace-this-line-with-your-code-chunk-8" class="level3">
<h3 class="anchored" data-anchor-id="replace-this-line-with-your-code-chunk-8">REPLACE THIS LINE WITH YOUR CODE CHUNK</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>colleges <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(name, <span class="st">"Technology"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(public <span class="sc">==</span> <span class="st">"Private"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, public, rel_attend, rel_attend_sat, par_top1pc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  name                               public rel_attend rel_attend_sat par_top1pc
  &lt;chr&gt;                              &lt;chr&gt;       &lt;dbl&gt;          &lt;dbl&gt;      &lt;dbl&gt;
1 California Institute Of Technology Priva…       3.47          0.611     0.0302
2 Massachusetts Institute Of Techno… Priva…       4.52          0.950     0.0571</code></pre>
</div>
</div>
<p>How to include Middlebury as well?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>colleges <span class="sc">|&gt;</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(name, <span class="st">"Technology|Middlebury"</span>)) <span class="sc">|&gt;</span> <span class="co"># Detect "Technology" OR "Middlebury"</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(public <span class="sc">==</span> <span class="st">"Private"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, public, rel_attend, rel_attend_sat, par_top1pc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  name                               public rel_attend rel_attend_sat par_top1pc
  &lt;chr&gt;                              &lt;chr&gt;       &lt;dbl&gt;          &lt;dbl&gt;      &lt;dbl&gt;
1 California Institute Of Technology Priva…       3.47          0.611     0.0302
2 Massachusetts Institute Of Techno… Priva…       4.52          0.950     0.0571
3 Middlebury College                 Priva…      10.6           2.90      0.228 </code></pre>
</div>
</div>
</section>
</section>
<section id="summarizing-by-group" class="level2">
<h2 class="anchored" data-anchor-id="summarizing-by-group">Summarizing by group</h2>
<p>So far we have been looking at individual colleges. But we know that some colleges share characteristics, like their tiers. It can be useful to know how some measures vary across tiers. For example, how could we find the average proportion of students from the top 1% for each test band tier?</p>
<p>One option would be to use the <code>group_by()</code> function and combine it with <code>summarise()</code>. The <code>group_by()</code> function pulls all the observations with the same values for the variable by which you are grouping. The <code>summarise()</code> function is where you say what you want done to each of those groups.</p>
<p>In this example, we want to group colleges into their test band tier categories. Then for each of them we want to create a new variable called <code>mean_par_top1pc</code> that is the <code>mean()</code> function applied to the <code>par_top1pc</code> variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>colleges <span class="sc">|&gt;</span> <span class="co"># the dataframe</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(test_band_tier) <span class="sc">|&gt;</span> <span class="co"># we want something for each value of this variable </span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_par_top1pc =</span> <span class="fu">mean</span>(par_top1pc)) <span class="co"># what we want for each group</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  test_band_tier        mean_par_top1pc
  &lt;chr&gt;                           &lt;dbl&gt;
1 Flagship                       0.0346
2 Ivy Plus                       0.155 
3 NESCAC                         0.200 
4 Other Top 100 Private          0.0907
5 Other Top 100 Public          NA     
6 Tier 2 Private                 0.134 </code></pre>
</div>
</div>
<p>There is an issue with the “Other Top 100 Public” group. Some observations in that tier are missing values for <code>par_top1pc</code>. We can remove the NAs using the <code>na.rm = TRUE</code> option.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>colleges <span class="sc">|&gt;</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(test_band_tier) <span class="sc">|&gt;</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_par_top1pc =</span> <span class="fu">mean</span>(par_top1pc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  test_band_tier        mean_par_top1pc
  &lt;chr&gt;                           &lt;dbl&gt;
1 Flagship                       0.0346
2 Ivy Plus                       0.155 
3 NESCAC                         0.200 
4 Other Top 100 Private          0.0907
5 Other Top 100 Public           0.0264
6 Tier 2 Private                 0.134 </code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>